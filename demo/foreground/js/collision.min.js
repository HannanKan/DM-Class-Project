function adBox(a) {
	var c = this.user = document.getElementById(a);
	var b = this.opts = b || {};
	this.child = []
}
adBox.prototype.addBall = function (a) {
	var length = this.user.rows.length;
	var x = this.user.insertRow(length);
	var y = x.insertCell(0);
	this.child.push(a);
	if (a.e.parentNode == this.adcontent) {
		y.appendChild(a.e)
	}
};


function Ball(a) {
	var a = this.json = a || {};
	var d = this.type = a.type || 'ball';
	var f = this.borderWidth = a.borderWidth || 0;
	var g = this.borderColor = a.borderColor || '#000';
	var x = this.width = a.x || 0;
	var y = this.height = a.y || 0;

	var c = this.c = a.c || 'white';
	var e = this.e = a.e || document.createElement('button');
	var m = this.m = a.m || 0;
	var n = this.n = a.n || 0;
	var j = this.html = a.html;
	var l = this.fontSize = a.fontSize || 18;
	var id = this.id = a.id || [];
	var adclick = this.adclick = a.adclick || false;
	var userclick = this.userclick = a.userclick || false;
	this.initStyle();
	this.addEvent();
	this.initOthers(m, n);
}
Ball.prototype.initStyle = function () {
	var s = this.e.style;
	s.position = 'relative';
	s.width = this.width + 'px';
	s.height = this.height + 'px';
	s.background = this.c;
	if (this.html) {
		this.e.innerHTML = this.html;
		s.textAlign = 'center';
		s.fontSize = this.fontSize + 'px'
	}
};
Ball.prototype.addEvent = function () {
	var a = this;
	this.e.onclick = function () {
		a.mouseclick();
	};
};
Ball.prototype.Getuser = function (ad) {
	var data = {};
	data['ad'] = ad;
	$.ajax({
		type: 'POST',
		url: "http://127.0.0.1:5000/getuser",
		data: JSON.stringify(data),  //转化字符串 
		contentType: 'application/json; charset=UTF-8',
		success: function (data) { //成功的话，得到消息
			var users = data
			var usersLength = users.length;
			var oB = new adBox('usercontent');
			for (var i = 0; i < usersLength; i++) {
				var x = mxwidth;
				var y = mxheight;
				var num = data[i];
				var user = new Ball({
					'x': x,
					'y': y,
					'm': 'user',
					'n': num,
				});
				oB.addBall(user);
			}
		}
	});
};
Ball.prototype.mouseclick = function () {
	var a = this;
	var id = a.e.id;  //获取点击按钮的id
	if (id.indexOf("ad") != -1) {  //恢复上一个点击按钮的颜色
		var advertisement = document.getElementById('advertisement');
		var childnum = advertisement.children;
		if (childnum.length != 0) {
			var childId = childnum[0].id;
			advertisement.removeChild(childnum[0]);
			var ballnum = document.getElementById(childId);
			ballnum.style.backgroundColor = "white";
			a.adclick = false;
		}
		a.e.style.background = 'orange';
		var boxnum = document.createElement('div');
		boxnum.id = id;
		advertisement.appendChild(boxnum);
		a.adclick = true;
		a.Getuser(id);
		var objS1 = document.getElementById('score');
		objS1.innerHTML = '';
		var user = document.getElementById('user');
		var childnum = user.children;
		if (childnum.length != 0) {
			var childId = childnum[0].id;
			console.log("remove user child：" + childId);
			user.removeChild(childnum[0]);
			var ballnum = document.getElementById(childId);
			ballnum.style.backgroundColor = "white";
			a.userclick = false;
		}
	}
	else if (id.indexOf("user") != -1) {  //恢复上一个点击按钮的颜色
		var user = document.getElementById('user');
		var childnum = user.children;
		if (childnum.length != 0) {
			var childId = childnum[0].id;
			user.removeChild(childnum[0]);
			var ballnum = document.getElementById(childId);
			ballnum.style.backgroundColor = "white";
			a.userclick = false;
		}
		a.e.style.background = 'orange';
		var boxnum = document.createElement('div');
		boxnum.id = id;
		user.appendChild(boxnum);
		a.userclick = true;
		console.log('userclick: ' + a.userclick);
	}
	a.boom();
};


Ball.prototype.initOthers = function (m, n) {
	var b = this.html = n;
	var s = this.e.style;
	this.e.innerHTML = b;
	s.textAlign = 'center';
	s.fontSize = this.fontSize + 'px'
	var u = this.e;
	var userId = m + n;
	u.id = userId;
};


Ball.prototype.boom = function () {
	var a = this;
	var advertisement = document.getElementById('advertisement');
	var adchildnum = advertisement.children;
	var user = document.getElementById('user');
	var userchildnum = user.children;
	if ((adchildnum.length != 0) && (userchildnum.length != 0)) {
		console.log("get ad and user");
		var objS1 = document.getElementById('advertisement');
		var ad = objS1.children[0].id;
		var objS2 = document.getElementById('user');
		var userr = objS2.children[0].id;
		var data = {};
		data['user'] = userr;
		data['ad'] = ad;
		$.ajax({
			type: 'POST',
			url: "http://127.0.0.1:5000/province",
			data: JSON.stringify(data),  //转化字符串 
			contentType: 'application/json; charset=UTF-8',
			success: function (data) { //成功的话，得到消息
				var objS1 = document.getElementById('score');
				objS1.innerHTML = data;
			}
		});
	}
};
